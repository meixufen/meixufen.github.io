<!DOCTYPE HTML>
<html>
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable"  content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no">
    <link rel="dns-prefetch" href="//t11.baidu.com">
    <!--SEO-->



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>coin-hive.com | 渣渣媛想学习</title>


    <link rel="alternate" href="/atom.xml" title="渣渣媛想学习" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    




    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css?rev=9.12.0">


<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    


    
    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header">
    <div class="main-header-box">
        <a class="branding" href="/" title="">
            <img src="/img/header_logo.png" alt="Snippet 博客主题">
        </a>
        <h2 class="text-hide">Snippet主题</h2>
        <img src="/img/header_logo.png" alt="Snippet 博客主题" class="hide">
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class=""><a href="/">Home</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/技术/">技术</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/随感/">随感</a></li>
                        
                            <li role="presentation" class=""><a href="/categories/旅游/">旅游</a></li>
                        
                            <li role="presentation" class=""><a href="https://github.com/meixufen">github</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="coin-hive.com">
            
            coin-hive.com
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <span>技术</span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            挖矿
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2017/11/22</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body">
        <p>最近老师想研究研究挖矿网站的工作，于是自己试着看了看相关的网站，记录部分结果如下：</p>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>首先了解一番挖矿究竟是啥，这里首先做个简单的比喻加深了解：<br>钱包——汇款地址：记录个人电子货币资产、操作交易、收发货币的一个hash地址；<br>矿池——工作单位：相关电子货币根据区块链统一分配“生产”任务的发布平台，也是算力效验的对接平台；<br>挖矿——努力工作：利用设备算力按特定电子货币生产计算方法和矿池分配方式产生的经济价值。<br>算力：计算机设备的工作能力。<br>共识机制——绩效评定方法：区块链系统中实现不同节点之间建立信任、获取权益的数学算法；<br>本文前端挖矿就是说“浏览器内实现、通过用户访问实施挖矿”的一种方式。<br>一般挖矿：用户以主动方式直接使用C或者其他语言构造的miner客户端进行CPU或GPU计算得到算力价值。<br>前端挖矿：用户以被动或主动方式在不知情或知情情况下由浏览者产生的CPU或GPU计算得到算力价值。<br>一般挖矿：利用CPU或GPU本身的高速浮点计算能力进行挖矿工作。而一般挖矿选取有更优秀浮点计算能力的GPU进行操作。从行为和实现方式看是一种主动在自己设备完成的挖矿行为，排除非法控制他人设备情况。c实现的工具直接使用OS的底层驱动和接口，无论操作内存、CPU或GPU流程损耗低计算速度更快。<br>前端挖矿：利用asm.js或webAssembly前端解析器中介在浏览器端被动使用用户的CPU完成挖矿或者利用Html5新规范WebGL利用浏览器完成GPU挖矿操作。从行为和实现方式看可以是一种以被动方式，在其他用户浏览到某网页情况下，在非己设备上发生的挖矿行为。通过将算力任务分担给其他浏览用户来实现“分布式”计算，其实更应该叫利用多设备优势提高单一时间内单目标多任务并发能力。</p>
<h2 id="coinhive挖矿"><a href="#coinhive挖矿" class="headerlink" title="coinhive挖矿"></a>coinhive挖矿</h2><p>coinhive专门提供一个用来挖矿的JS引擎，在被攻击网站上的网页内嵌一段JS代码，只要有人访问被攻击网站，挖矿程序就会在网民的电脑上工作，占用大量的系统资源，导致CPU利用率突然提升。但是此JS只能用于挖取门罗币，在FOFA上查询此JS代码部署情况的结果如下：<br><img src="/images/coin/1.png" alt=""><br>查看具体网站：<br>HTML中嵌入脚本代码，引用了<a href="https://coinhive.com/lib/coinhive.min.js" target="_blank" rel="external">https://coinhive.com/lib/coinhive.min.js</a><br>并嵌入script脚本启动挖矿代码。</p>
<h3 id="！！！以下网址不要随意点击，否则浏览器很可能卡壳。"><a href="#！！！以下网址不要随意点击，否则浏览器很可能卡壳。" class="headerlink" title="！！！以下网址不要随意点击，否则浏览器很可能卡壳。"></a>！！！以下网址不要随意点击，否则浏览器很可能卡壳。</h3><p>网址：<a href="http://40.74.52.110/" target="_blank" rel="external">http://40.74.52.110/</a><br> <img src="/images/coin/w1.png" alt=""><br> <img src="/images/coin/w2.png" alt=""></p>
<p>无限制时几乎占据所有CPU资源。</p>
<p>网址：<a href="http://ya.topbloger.ru/page/t30p-mobile-application.aspx" target="_blank" rel="external">http://ya.topbloger.ru/page/t30p-mobile-application.aspx</a><br> <img src="/images/coin/w21.png" alt=""><br> <img src="/images/coin/w22.png" alt=""></p>
<p>（此处之所以CPU占比不是90%左右，是因为线程数是1，本计算机CPU核数是8核，均分后CPU占比10%左右）</p>
<p>网址：<a href="http://52.192.18.99:443/" target="_blank" rel="external">http://52.192.18.99:443/</a><br>body中<br> <img src="/images/coin/w31.png" alt=""><br> <img src="/images/coin/w32.png" alt=""></p>
<p>网址：<a href="http://cinemaflix.net/" target="_blank" rel="external">http://cinemaflix.net/</a><br> <img src="/images/coin/w41.png" alt=""><br> <img src="/images/coin/w42.png" alt=""></p>
<p>网址：<a href="http://40.74.52.110/m.html" target="_blank" rel="external">http://40.74.52.110/m.html</a><br>  <img src="/images/coin/w51.png" alt=""><br> <img src="/images/coin/w52.png" alt=""></p>
<p>搜索中国存在的挖矿网站：<br>目前:<br>  <img src="/images/coin/ch.png" alt=""></p>
<p>网址：<a href="http://139.159.234.34/" target="_blank" rel="external">http://139.159.234.34/</a><br>  <img src="/images/coin/w61.png" alt=""><br> <img src="/images/coin/w62.png" alt=""></p>
<p>网址：<a href="https://158.140.230.27/" target="_blank" rel="external">https://158.140.230.27/</a><br>  <img src="/images/coin/w71.png" alt=""><br> <img src="/images/coin/w72.png" alt=""></p>
<p>被谷歌识别出来的恶意网站：<br>  <img src="/images/coin/evil.png" alt=""></p>
<h2 id="script代码分析"><a href="#script代码分析" class="headerlink" title="script代码分析"></a>script代码分析</h2><h3 id="3个构造函数："><a href="#3个构造函数：" class="headerlink" title="3个构造函数："></a>3个构造函数：</h3><p>CoinHive.Anonymous(siteKey [, options])                //创建挖矿流程，但是未绑定到token或用户名上。<br>CoinHive.User(siteKey, userName [, options])        //开启并绑定所以的hash到用户上。<br>CoinHive.Token(siteKey, targetHashes [, options])   //开启挖矿流程，一旦指定hash找到则停止挖矿。<br>SiteKey注册网站给每个用户一个唯一的key作为标识，其是门罗币收款的账户。<br>Username：用户账户在网站上唯一标识符。</p>
<h3 id="Options："><a href="#Options：" class="headerlink" title="Options："></a>Options：</h3><p>Threads：miner开启的线程数，默认是navigator.hardwareConcurrency,即CPU核数；<br>AutoThreads：是否自动调整线程数获得最佳性能，实验性功能，默认false；<br>Throttle：线程应该空闲的时间比例，默认为0，查看miner.setThrottle()设定；<br>forceASMJS：true表示miner使用asm.js的hsash算法实现，false表示使用更快的ebAssembly版本（如果支持），否则回退到asm.js，默认false；<br>theme：AuthedMine中屏幕可以选的颜色主题，light和dark，默认light；<br>language    ：AuthedMine中屏幕可选的语言，默认的auto表示用户浏览器设定中的语言。</p>
<p>代码如下：<br>var miner = new CoinHive.User(‘YOUR_SITE_KEY’, ‘john-doe’, {<br>    threads: 4,<br>    autoThreads: false,<br>    throttle: 0.8,<br>    forceASMJS: false,<br>    theme: ‘dark’,<br>    language: ‘auto’<br>});</p>
<h3 id="start-mode-方法："><a href="#start-mode-方法：" class="headerlink" title=".start([mode])方法："></a>.start([mode])方法：</h3><p>连接到pool并启动mining。<br>可选mode指明当有一个miner在另外tab页运行时，此miner应该如何工作，默认是：CoinHive.IF_EXCLUSIVE_TAB；<br>CoinHive.IF_EXCLUSIVE_TAB：miner只有在其他tab页没有挖矿的情况下启动，其他tab页miner停止或关闭后开始工作；<br>CoinHive.FORCE_EXCLUSIVE_TAB：miner强制开始并杀死其他tab页中没有指定CoinHive.FORCE_MULTI_TAB 的miner；<br>CoinHive.FORCE_MULTI_TAB：miner总是开始，不会kill其他miner，也不会被其他miner杀死，但那时只能使用captcha（验证码）和shortlinks使用。</p>
<h3 id="Coinhive-com的库文件"><a href="#Coinhive-com的库文件" class="headerlink" title="Coinhive.com的库文件"></a>Coinhive.com的库文件</h3><p><a href="https://coinhive.com/lib/" target="_blank" rel="external">https://coinhive.com/lib/</a><br>|—— coinhive.min.js                            // wss矿池通信分配worker交互实现<br>|   :.. (CoinHive.CONFIG.WEBSOCKET_SHARDS)     // WebSocket地址连接pool进行任务发布等功能<br>|   :.. (CoinHive.CRYPTONIGHT_WORKER_BLOB)     // 以CreateURL形式动态生成Blob链接对worker内容实现<br>|—— cryptonight.wasm          // WebAssembly实现预计源cryptonight.c &amp; keccak.c 等<br>|—— cryptonight-asmjs.min.js  // 兼容方案asmjs实现内容worker除外从L4851算法开始<br>|__ cryptonight-asmjs.min.js.mem    // 浏览器中asmjs所需模拟内存实现</p>
<p>cryptonight.wasm &amp; cryptonight-asmjs.min.js主要就是cryptonight算法的实现；</p>
<h3 id="CryptoNight算法："><a href="#CryptoNight算法：" class="headerlink" title="CryptoNight算法："></a>CryptoNight算法：</h3><p>是一个使用物理内存的高强度hash算法函数。 它的设计适用于GPUFPGA和ASIC架构上的有效性算力。步骤：<br>1)    初始化大型暂存器与伪随机数据；<br>2)    算法对暂存器中包含伪随机地址的大量的读/写计算操作；<br>3)    将整个暂存器的hash值进行hash效验验证本次计算产生的价值。</p>
<p>初始化流程：<br>1）使用参数 b = 1600 和 c = 512 .对输入内容进行Keccak计算 [ KECCAK ]。计算结果的0..31字节用作AES-256密钥[AES]并扩展为10个循环密钥申请一个分配了2097152字节2 MB空间的暂存器；从计算结果的64..191字节处提取出来数据并分割成8个块每个块16字节。使用以下步骤对每个块进行加密</p>
<p>aes_round() 函数执行一轮AES加密对本块执行 SubBytes ShiftRows 和 MixColumns 步骤其结果与round_key进行异或运算。但这不同于AES加密算法第一轮计算和最后一轮计算没什么不同。<br>2）一轮下来得到的计算结果写入暂存器的前128个字节然后这些结果再次代入加密循环再把这次循环结果写入暂存器的第二个128字节里。这里每次往暂存器里写入下一个128字节都代表对先前写入的128字节内容在新一轮加密的结果。流程一直循环直到暂存器写满。至此一次算法的初始化就完成了。<br>该图表示暂存器初始化：<br>  <img src="/images/coin/buz.png" alt=""></p>
<p>更多信息见详细网站：<br>Coinhive挖矿脚本分析与Pool改造自建(一)：<br><a href="http://www.freebuf.com/column/151316.html" target="_blank" rel="external">http://www.freebuf.com/column/151316.html</a><br>【不就是浏览器挖矿嘛】Coinhive挖矿脚本分析与Pool改造自建(二)：<br><a href="http://www.freebuf.com/column/151376.html" target="_blank" rel="external">http://www.freebuf.com/column/151376.html</a></p>

    </div>

    <div class="post-footer">   
        <div>
            
                转载声明: 商业转载请联系作者获得授权,非商业转载请注明出处 © Snippet
            
        </div>
        <div>
            
                License: <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" target="_blank">
知识共享署名-非商业性使用-禁止演绎 3.0 未本地化版本许可协议（CC BY-NC-ND 3.0）
</a>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2017/11/24/tech/nginx字段/" class="pre-post btn btn-default"><i class="fa fa-angle-left fa-fw"></i>上一篇</a>
    
    
        <a href="/2017/11/08/tech/nginx配置文件/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
    <div id="uyan_frame"></div>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>








    </div>





                </main>
                
    <aside class="col-md-4 sidebar">
        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>个人的第一个博客，成立不久，后续慢慢添加，欢迎交流：meixufen@whu.edu.cn<br>
        </div>
    </div>

        
        
    <div class="widget">
        <h3 class="title">Categories</h3>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/"><i class="fa" aria-hidden="true">技术</i></a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/旅游/"><i class="fa" aria-hidden="true">旅游</i></a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link current" href="/categories/随感/"><i class="fa" aria-hidden="true">随感</i></a><span class="category-list-count">2</span></li></ul>
    </div>


        
        
    <div class="widget">
      <h3 class="title">Archives</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/"><i class="fa" aria-hidden="true">December 2017</i></a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/"><i class="fa" aria-hidden="true">November 2017</i></a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/"><i class="fa" aria-hidden="true">October 2017</i></a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/"><i class="fa" aria-hidden="true">September 2017</i></a><span class="archive-list-count">4</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">Tag Cloud</h3>
    <div class="content tag-cloud">
      
        <a href="undefinedtags/nginx/" style="font-size: 1em;">nginx</a> <a href="undefinedtags/nginx-服务器配置/" style="font-size: 1em;">nginx 服务器配置</a> <a href="undefinedtags/扩展/" style="font-size: 1em;">扩展</a> <a href="undefinedtags/挖矿/" style="font-size: 1em;">挖矿</a> <a href="undefinedtags/PHP-安全登录-RSA/" style="font-size: 1em;">PHP 安全登录 RSA</a> <a href="undefinedtags/制作博客/" style="font-size: 1em;">制作博客</a> <a href="undefinedtags/阅读论文/" style="font-size: 1em;">阅读论文</a> <a href="undefinedtags/诗/" style="font-size: 1em;">诗</a> <a href="undefinedtags/php-ajax-session-判断登录状态/" style="font-size: 1em;">php ajax session 判断登录状态</a> <a href="undefinedtags/半生缘-张爱玲/" style="font-size: 1em;">半生缘 张爱玲</a> <a href="undefinedtags/游记/" style="font-size: 1em;">游记</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">Friends</h3>
        <div class="content friends-link">
        
            <a href="http://meixufen.github.io" class="fa" target="_blank">作者博客</a>
        
        </div>
    </div>


        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>






    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017 
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>

  <script src="/assets/highlight.pack.js?rev=@@hash"></script>
  <script>
    hljs.initHighlightingOnLoad(); //初始化代码高亮 
  </script>

<script src="/js/app.js?rev=@@hash"></script>

</body>
</html>